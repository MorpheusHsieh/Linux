How to install VMware Tools under CentOS 7 ?

VMware Tools 是 VMware 公司為了讓虛擬主機和宿主主機之間可以互相交換檔案而設計的。


0. 由於 VMware Tools 需要一些套件才能執行，所以需要先安裝

   # yum -y install perl gcc make kernel-headers kernel-devel


1. select VM > Install VMware Tools (or update VMware Tools). 


2. If a mount point directory does not already exist, create it.

   # mkdir /mnt/cdrom

   
3. Mount the CD-ROM drive.

   # mount /dev/cdrom /mnt/cdrom

   
4. Change to a working directory, for example, /tmp.

   # cd /tmp

   
5. Uncompress the installer.

   # tar -zxpf /mnt/cdrom/VMwareTools-10.0.10-4301679.tar.gz

   
6. If necessary, unmount the CD-ROM image.

   # umount /dev/cdrom 


8. Run the installer and configure VMware Tools.

   # cd vmware-tools-distrib
   # ./vmware-install.pl -d (安裝時不需回答問題)


   Usually, the vmware-config-tools.pl configuration file runs after the installer file finishes running. 
   
   但是因為 CentOS 7 的核心版本是 3.10.0，所以會發生編譯錯誤。
   
   錯誤訊息如下：
   

   /tmp/modconfig-36luPI/vmhgfs-only/page.c:1649:23: error: too many arguments to function ‘wait_on_bit’


　　上网查到 https://communities.vmware.com/message/2637447，

	根据里面的提示，又去到 https://communities.vmware.com/message/2637118#2637118，
	
	找到解决方案：

	a. 在解压后的 vmware-tools-distrib/ 目录中，进入到 lib/modules/source/，
	
	   解压 vmhgfs.tar，得到 vmhgfs-only 目录。
	  
			$ tar -xpf vmhgfs.tar
	  

	b. 修改文件 vmhgfs-only/page.c
	
		$ vi vmhgfs-only/page.c
	
		把第1639行的

			#if LINUX_VERSION_CODE >= KERNEL_VERSION(3, 19, 0)

		改成

　　		#if LINUX_VERSION_CODE >= KERNEL_VERSION(3, 10, 0)

	   
	c. 重新把 vmhgfs-only 目录打包为 mvhgfs.tar。
	
			$ tar -cpf vmhgfs.tar vmhgfs-only

			
	d. 重新执行安装脚本 vmware-install.pl。  

	
	e. 到虛擬主機的 Options 頁面，將 Shared Folders 項目設定好，增加一個 Floders，

	   再指向宿主主機下的一個特定目錄，將虛擬主機重新開機，
	
	   然後，就可以在 /mnt/hgfs 下看到剛剛在宿主主機設定的共享目錄的內容了。
   
   

