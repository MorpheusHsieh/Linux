How to solve an expired key (KEYEXPIRED) with apt

Updating expired keys on Debian and Ubuntu

  Software updates and package management is easy with systems based on Debian or Ubuntu. 

  Just apt-get update (or apt update) and run an upgrade. 

  But sometimes you may encounter the following situation: a KEYEXPIRED message.
  
  
	執行 sudo apt-get update 時出現下列訊息：
	
	...
	錯誤:7 http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 Release.gpg
    以下簽名無效： KEYEXPIRED 1515625755
	...


Solution:

	Step 1: Run apt-key
		
		Using the apt-key utility we can display all the known keys.

			$ apt-key list

		In our case, we see the nginx key is expired a few days ago:

			...
			pub   1024D/FBB75451 2004-12-30
			uid                  Ubuntu CD Image Automatic Signing Key <cdimage@ubuntu.com>

			pub   4096R/EA312927 2015-10-09 [過期: 2017-10-08]
			uid                  MongoDB 3.2 Release Signing Key <packaging@mongodb.com>
			
			pub   4096R/A15703C6 2016-01-11 [過期: 2018-01-10]
			uid                  MongoDB 3.4 Release Signing Key <packaging@mongodb.com>
			...

		Three items are highlighted in this example. 
		
		The first one is the short version of the key. 
		The second and third one are showing that the key is expired (including the date). 
		The second key was valid for almost 3 months.
		The third key was valid for almost 1 months.

		To quickly find the expired keys, search for “expired:”

			$ apt-key list | grep “expired:”
			
		However, this instruction not work for chinese '過期:'

		
	Step 2: Update the key
	
		We can now use the key gathered in step 1 to update the second key:

			$ apt-key adv --keyserver keys.gnupg.net --recv-keys A15703C6

			Executing: /tmp/tmp.aR5LzDo26y/gpg.1.sh --keyserver
			keys.gnupg.net
			--recv-keys
			A15703C6
			gpg: 正在請求金鑰 A15703C6 自 hkp 伺服器 keys.gnupg.net
			gpg: 金鑰 A15703C6: "MongoDB 3.4 Release Signing Key <packaging@mongodb.com>" 1 份新的簽章
			gpg: 處理總量: 1
			gpg:         新的簽章: 1
			... 未改變
			gpg: 寫入鑰匙圈 `/etc/apt/trusted.gpg' 時出錯: 檔案寫入錯誤
			gpg: 金鑰 A15703C6: "MongoDB 3.4 Release Signing Key <packaging@mongodb.com>" 1 份新的簽章
			gpg: 讀取 `[stdin]' 時出錯: 檔案寫入錯誤
			gpg: import from `[stdin]' failed: 檔案寫入錯誤
			gpg: 處理總量: 5
			gpg:              未改變的: 5
			gpg:         新的簽章: 1


		Since I see a new siganature message, I think key recover is success.
		Next, I delete the third key:
		
			$ sudo apt-key del EA312927
			OK

		Next, I want to update again, and keyexpire appears again
			
			$ sudo apt-get update
			
			...
			錯誤:11 http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 Release.gpg
			以下簽名無效： KEYEXPIRED 1515625755
			...

		So, I delete the expire key 1515625755 and update again, but another keyexpire message appear.
		
			$ sudo apt-key del 1515625755
			OK
			$ sudo apt-get update

			...
			錯誤:11 http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 Release.gpg
			以下簽名無效： KEYEXPIRED 1515625755
			...
			
		I show apt-key list again.
		
			$ apt-key list	
			
			...
			pub   4096R/A15703C6 2016-01-11 [過期: 2018-01-10]
			uid                  MongoDB 3.4 Release Signing Key <packaging@mongodb.com>
			...
			
		Delete the expire key, update again, and new error message appears.
		
			$ sudo apt-key del A15703C6
			

			...
			錯誤:7 http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 Release.gpg
			由於無法取得它們的公鑰，以下簽章無法進行驗證： NO_PUBKEY BC711F9BA15703C6
			...
			
		I import public golden key from mongodb server, but it doesn't work.
		
		
			$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
			Executing: /tmp/tmp.BJNDUMBxOV/gpg.1.sh --keyserver
			hkp://keyserver.ubuntu.com:80
			--recv
			2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
			gpg: 正在請求金鑰 91FA4AD5 自 hkp 伺服器 keyserver.ubuntu.com
			gpg: 金鑰 91FA4AD5: 公鑰 "MongoDB 3.6 Release Signing Key <packaging@mongodb.com>" 已匯入
			gpg: 處理總量: 1
			gpg:               已匯入: 1  (RSA: 1)
			
		Finally, I execute the following commands, then it is correct.
		
		
			$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BC711F9BA15703C6
			Executing: /tmp/tmp.ieknEVvL5y/gpg.1.sh --keyserver
			keyserver.ubuntu.com
			--recv-keys
			BC711F9BA15703C6
			gpg: 正在請求金鑰 A15703C6 自 hkp 伺服器 keyserver.ubuntu.com
			gpg: 金鑰 A15703C6: 公鑰 "MongoDB 3.4 Release Signing Key <packaging@mongodb.com>" 已匯入
			gpg: 處理總量: 1
			gpg:               已匯入: 1  (RSA: 1)

		Now, I can run apt-get update and upgrade.
		
		